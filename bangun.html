<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Check-in Staff</title>

<!-- ================= CSS ================= -->
<style>
:root{
  --bg:#0f0f1a;
  --card:#16162b;
  --accent:#7e57c2;
  --accent2:#b39ddb;
  --ok:#4caf50;
  --no:#ef5350;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:radial-gradient(circle at top,var(--accent),var(--bg));
  color:#fff;
}

.container{
  max-width:1100px;
  margin:30px auto;
  padding:20px;
  background:rgba(0,0,0,.7);
  border-radius:14px;
  box-shadow:0 0 30px var(--accent);
}

h1{
  text-align:center;
  margin-bottom:20px;
  color:var(--accent2);
  letter-spacing:1px;
}

.tabs{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-bottom:20px;
}

.tabs button{
  padding:10px 22px;
  border:none;
  border-radius:10px;
  background:#2a235a;
  color:#fff;
  cursor:pointer;
  transition:.3s;
}

.tabs button.active{
  background:var(--accent);
  box-shadow:0 0 12px var(--accent2);
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  padding:12px;
  text-align:center;
}

th{
  background:#2a235a;
}

tr:nth-child(even){
  background:rgba(255,255,255,.05);
}

.status-ok{color:var(--ok)}
.status-no{color:var(--no)}

.btn{
  padding:6px 16px;
  border:none;
  border-radius:8px;
  background:var(--ok);
  color:#fff;
  cursor:pointer;
  transition:.2s;
}

.btn:disabled{
  background:#2e7d32;
  cursor:not-allowed;
}

.loading{
  text-align:center;
  padding:30px;
  opacity:.8;
}

footer{
  text-align:center;
  margin-top:20px;
  font-size:12px;
  opacity:.6;
}
</style>
</head>

<body>

<div class="container">
  <h1>SISTEM CHECK-IN STAFF</h1>

  <div class="tabs">
    <button class="tab active" data-shift="PAGI">PAGI</button>
    <button class="tab" data-shift="SORE">SORE</button>
    <button class="tab" data-shift="MALAM">MALAM</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Nama</th>
        <th>Jabatan</th>
        <th>Jam</th>
        <th>Status</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <tr><td colspan="5" class="loading">Loading...</td></tr>
    </tbody>
  </table>

  <footer>LINE TOGEL â€¢ Check-in System</footer>
</div>

<!-- ================= JS ================= -->
<script>
/* ================= KONFIG ================= */
const API_URL = "https://script.google.com/macros/s/AKfycbwD34ZYEn_rpIRauPofqCy9j0io0LyH0xgg7dN5fXskH8KzOUzOrNPLSFVXn12EFungnA/exec";

let currentShift = "PAGI";

/* ================= LOAD DATA ================= */
async function loadStaff(){
  const tbody = document.getElementById("tbody");
  tbody.innerHTML = `<tr><td colspan="5" class="loading">Loading...</td></tr>`;

  try{
    const res = await fetch(`${API_URL}?action=getStaff&shift=${currentShift}`);
    const json = await res.json();

    if(!json.data || !json.data.length){
      tbody.innerHTML = `<tr><td colspan="5">Tidak ada data</td></tr>`;
      return;
    }

    tbody.innerHTML = "";
    json.data.forEach(d=>{
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${d.name}</td>
        <td>${d.position}</td>
        <td>${d.workHours || "-"}</td>
        <td class="${d.checkIn ? "status-ok":"status-no"}">
          ${d.checkIn ? "Check-in "+d.checkIn : "Belum"}
        </td>
        <td>
          <button class="btn" ${d.checkIn ? "disabled":""}>
            ${d.checkIn ? "OK":"CHECK-IN"}
          </button>
        </td>
      `;

      const btn = tr.querySelector("button");
      if(!d.checkIn){
        btn.onclick = ()=>checkIn(d.rowIndex);
      }

      tbody.appendChild(tr);
    });

  }catch(err){
    tbody.innerHTML = `<tr><td colspan="5">Gagal memuat data</td></tr>`;
  }
}

/* ================= CHECK-IN ================= */
async function checkIn(rowIndex){
  if(!confirm("Yakin check-in sekarang?")) return;

  await fetch(API_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      action:"absen",
      shift:currentShift,
      rowIndex:rowIndex
    })
  });

  loadStaff();
}

/* ================= TAB ================= */
document.querySelectorAll(".tab").forEach(btn=>{
  btn.onclick = ()=>{
    document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    currentShift = btn.dataset.shift;
    loadStaff();
  };
});

/* ================= INIT ================= */
loadStaff();
</script>

</body>
</html>
